# <center/> 分布式温控系统解决方案 <center/>

[TOC]

## 1. 产品介绍及相关说明

### 1.1 产品背景

> 某快捷廉价酒店响应节能绿色环保理念，推行自助计费式中央温控系统，使得入住的客户可以根据要求设定温度和风速的调节，同时可以显示所需支付的金额。
> 
### 1.2 产品功能简介

> 自助式的分布式温控系统，可以让入住的客户根据自己的需求调节房间的温度以及风速，并且可以实时显示出客房空调消耗的能量所产生的费用。当客户退房时，前台可以出具空调的使用详单及账单。空调运行期间，空调管理员能够监控各房间空调的使用状态，此外，酒店经理在需要的情况下可以查看不同时间范围内的格式化统计报表。
> 
### 1.3 缩写说明

 * `UML`：统一建模语言（Unified Modeling Language）是一种面向对象系统的产品进行说明、可视化和编制文档的一种标准语言
> 
 * `ACA`：空调管理人员（Air Conditioner Adminstrator）
> 
 * `HM`：酒店经理（Hotel Manager）
> 
 * `HC`：入住酒店的客户（Hotel Customer）
 > 
* `FO`：酒店前台（Front Office）
> 
 * `TCS`：自助分布式中央温控系统，简称温控系统（Temperature Control System）
> 
### 1.4 术语定义

 * 详单：酒店入住客户使用酒店自助计费式中央温控系统的详细记录，通过详单展现空调的计时、耗电、计费等信息
	 * 提供者：`FO`（酒店前台）
>
 * 统计报表：指酒店按照规定的表格形式、内容、时间报送程序，自上而下统一布置、提供统计资料的一种统计调查方式
	 * 提供者：`HM`（酒店经理）
> 
### 1.5 数据说明

* 时间
  * 使用空调计时：分钟数
    * 整数
    * 未满1分钟则向上取整
  * 显示当前时间：年-月-日 时 : 分
> 
* 温度
  * 传感器检测实时室温（0.5℃ 为间隔）
  * 参数调节温度（1℃ 为间隔）
> 
* 耗电
  * 由系统运行模式和使用时间共同决定，按照耗电标准计算

* 金额
  * 按耗电量计算，1元 / ℃
> 
### 1.6 引用标准

> 《需求规格说明书格式标准》
> 
## 2. 产品服务对象

### 2.1 客户

快捷廉价酒店

* 前台：出具账单，结账收费，指引向导
* 酒店经理：有管理、会计等相关知识，对`TCS`的运作不熟悉
* 空调管理员：熟悉`TCS`的运作

### 2.2 用户

入住快捷廉价酒店的房客
* 成年人为主，入住目的多为旅行、出差
* 对空调的基本使用有一定了解

## 3. 产品功能需求

### 3.1 主机/中央控制系统

> 使用对象：客户，即快捷廉价酒店的工作人员（前台、管理员和经理）
> 系统功能：能够处理从机发来的请求，并且根据请求发送相应的命令

#### 3.1.1 控制功能
> 参与者： `ACA（空调管理人员）`

| 功能     | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| 电源控制 | 能够人工启动和关闭整个中央控制系统。开启后及时接收从机消息，关机时从机也不工作。 |
| 参数控制 | 空调启动时，参数默认为上次关机时的参数，也可以设置主机工作参数，然后再进入服务 |
| 参数重置 | 时间记录、参数、计费等异常时可手动重置                       |
| 调节控制 | 根据从机的请求，自动调节对应客房的空调模式、送风温度及风速 |
| 负载均衡 | 自定义调度算法实现对从机请求的均衡调节                       |

#### 3.1.2 统计功能
> 参与者：`HM（酒店经理）` / `FO（酒店前台）`

| 功能     | 描述                                                     |
| -------- | -------------------------------------------------------- |
| 计算费用 | 按照系统设置的计费标准，实时计算用户的使用金额           |
| 实时反馈 | 计算所得消费金额能够实时反馈发送给从机                 |
| 统计报表 | 可以生成日报表、周报表、月报表、房间账单、详单等统计报表 |
| 日志记录 | 每分钟记录系统运行的统计信息并持久化到本地               |
| 信息查询 | 房间账单、详单、报表等可以随时查询                       |

#### 3.1.3 监控功能
> 参与者： `ACA（空调管理人员）`

| 功能     | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| 数据存储 | 将实时采集到的数据存储到数据库中                             |
| 监视数据 | 能够监视所有客房的空调工作信息，房间实际温度、风速、目标温度等信息 |
| 异常报警 | 对于存在异常如温度失常、机器宕机等情况的房间，能够立即向管理员发出警报 |

### 3.2 从机/子控制系统

> 使用对象：用户，即入住酒店的房客
> 系统功能：能够根据用户的需求向主机发送请求从而调节空调，面板会显示温度、风速、模式、时间、费用等信息

说明：不考虑房间大小和管道的分布，在达到目标温度后，房间温度每分钟变化率一定。

#### 3.2.1 调节功能

| 功能     |                             描述                        |
| ------- | -------------------------------------------------------|
| 状态切换 | 从机随主机开机后，默认处于待机状态。使用空调时，从机处于工作状态  |
| 模式切换 | 根据需要切换制冷模式和制热模式                               |
| 温度调节 | 根据需要设置目标温度。单次按键调节温度：1℃；温度范围：制冷模式18-25℃，制热模式25-30℃|
| 风速调节 | 可以设置高风、中风和低风三种风速                             |

#### 3.2.2 服务功能

| 功能     |                描述                 |      备注      |
| -------- | -----------------------------------|------------- |
| 数据获取 | 自动获取用户按键输入以及传感器收集的房间温度信息|用户连续多次按键时间间隔不足1秒时，只发送末次指令参数|
| 收发消息 | 从机将实时收集到的信息立即发送到主机 ||
| 面板显示 | 用户设置的温度、模式、风速，以及当前室温、使用费用、当前时间以及使用时间可显示在面板上 | 用户可通过按键获取使用时间及消费金额，未按键时每隔1min更新一次 |
#### 3.2.3 调度策略

基本的调度策略为：优先级调度+时间片调度

调度对象负责接收空调客户端的请求，然后转发给服务对象进行温度计算和计费。

调度的依据为风速，根据需求，调度时首先考虑优先级调度策略；当所有请求的风速相同时，再进行时间片调度， 具体为：

（1）当服务对象数小于服务对象上限时，所有请求会被分配一个服务对象

（2）当服务对象数大于服务对象上限时，执行调度策略：

* 首先考虑优先级调度策略：比较请求服务的风速与服务对象风速的大小关系

  * 如果大于，则执行优先级调度策略，再判断服务对象风速小于请求风速的个数：

    * 若只有一个，则该房间被放置于等待队列，并分配一个等待服务时长；服务对象被释放并分配给新的请求对象。
    * 若有多个服务对象的风速低于请求对象风速，且风速最低的服务对象仅有一个，则该对象被放置于等待队列，该房间被释放并分配给新的请求对象。
    * 若有多个服务对象的风速低于请求对象风速，且风速最低的服务对象有一个以上，则服务时长最大的服务对象被放置于等待队列，该房间被释放并分配给新的请求对象。
* 如果等于，则执行时间片调度策略：
  
  * 将请求对象放置于等待队列，并为等待队列设置一个等待服务时长 **T（2min）**。
  
  * 若在等待时间 **T** 内有任意一个服务对象达到目标温度或关机，即服务对象释放，则按先进先出的原则，从等待队列中取一个请求获得服务对象。若等待队列为空，则不变。
  
  * 每隔时间 **T** 都会从等待队列中取出一个服务请求，将服务队列中服务时长最大的服务对象释放，该房间的请求放置于等待队列，服务对象被释放并分配给请求对象。
  * 如果小于，则将请求对象放入等待队列中，按时间片调度策略处理。

  > 解决方案：
  >
  > 主要通过创建两个队列来完成上述需求：
  >
  > 1. 服务队列：记录房间号和服务对象的Id，风速以及服务时长；
  >
  > 2. 等待队列：记录房间号、风速和分配的等待服务时长。

## 4. 整体流程

<img src="pic\whole_process.png" style="zoom: 67%;" />

## 5. 注意事项

* 温控范围
  * 制冷模式：18-25℃
  * 制热模式：25-30℃
  * 缺省温度：25℃
* 计费标准
  * 1 元 / 度
* 耗电标准
  * 高风：1 度 / 1 分钟
  * 中风：1 度 / 2 分钟
  * 低风：1 度 / 3 分钟
* 室温变化模式
  * 向设定方向变化
    * 低风模式：0.4 ℃ / min
    * 中风模式：0.5 ℃ / min
    * 高风模式：0.6 ℃ / min
  * 向室温方向变化
    * 关机状态：0.5 ℃ / min
* 温度调节按钮
  * 连续2次或多次指令发送时间间隔
    * < 1 s：只发送最后 1 次的指令参数
    * ≥ 1 s：发送 2 次请求
* 房间空调账单格式

| 日期         | 耗电量 | 费用 |
| ------------ | ------ | ---- |
| `2020-03-13` | `C1`   | `S1` |
| `2020-03-14` | `C2`   | `S2` |
| `2020-03-15` | `C3`   | `S3` |
| ...          | ...    | ...  |

* 房间空调详单格式

| 日期         | 时段          | 风速模式 | 使用时长 | 耗电量 | 费用  |
| ------------ | ------------- | -------- | -------- | ------ | ----- |
| `2020-03-13` | `20:19-22:30` | 高风     | `T`      | `T`    | `T`   |
| `2020-03-13` | `16:29-18:40` | 中风     | `T`      | `T/2`  | `T/2` |
| `2020-03-13` | `11:09-13:20` | 低风     | `T`      | `T/3`  | `T/3` |
| ...          | ...           | ...      | ...      | ...    | ...   |

## 6. 技术路线

* 开发语言：`Python`
* 数据库：`MySQL` / `SQLite` / `SQL server`
* 系统：`Windows` / `Linux`
* 硬件配置：温度传感器（模拟）

#### 6.1 C/S架构

* 客户端：`PyQT` / `wxPython`
* 服务端：`Socket` / `Twisted`

## 7. 人员配置

小组总共五名成员，总共分为服务端开发，客户端开发，文档撰写与测试（暂定），可随时调整。
>>>>>>> develop
